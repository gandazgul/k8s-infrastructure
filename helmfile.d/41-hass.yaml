# Config for Home Assistant ====================================================================
# Home assistant is the command center for the smart home

# NOTE: cli args take precedence over these
helmDefaults:
  wait: true
  timeout: 600
  force: true

repositories:
- name: k8s-at-home
  url: https://k8s-at-home.com/charts/

releases:
- name: home-assistant
  namespace: default
  chart: k8s-at-home/home-assistant
#  version: 4.0.0
  values:
    - controllerType: deployment
    - image:
        tag: stable
        pullPolicy: Always
    - env:
        TZ: "America/New_York"
#    - hostNetwork: true
    - ingress:
        enabled: true
        hosts:
          - host: hass.{{ requiredEnv "INGRESS_EXTERNAL_NAME" }}
            paths:
              - path: /
        tls:
        - hosts:
          - hass.{{ requiredEnv "INGRESS_EXTERNAL_NAME" }}
          secretName: hass-cert
        annotations:
          kubernetes.io/ingress.class: "nginx"
          cert-manager.io/cluster-issuer: "letsencrypt-prod"
          nginx.org/websocket-services: home-assistant
    - persistence:
        config:
          enabled: true
          existingClaim: yasr-volume
          subPath: "configs/hass"
          mountPath: "/config"
    - addons:
        codeserver:
          enabled: true
          image:
            tag: 3.9.0
          workingDir: "/config"
          args:
          - --auth
          - "none"
          - --user-data-dir
          - "/config/.vscode"
          - --extensions-dir
          - "/config/.vscode"
          ingress:
            enabled: true
            annotations:
              kubernetes.io/ingress.class: "nginx"
              cert-manager.io/cluster-issuer: "ca-issuer"
            hosts:
            - host: hass-config.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
              paths:
              - path: /
            tls:
            - hosts:
              - hass-config.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
              secretName: hass-config-k8s-cert
          volumeMounts:
          - name: config
            mountPath: /config
#            subPath: "configs/hass"

# do I need this?
#          - name: deploykey
#            mountPath: /root/.ssh/id_rsa
#            subPath: id_rsa
#    - appdaemon:
#        enabled: true
#        ingress:
#          enabled: true
#          hosts:
#          - hass-appdaemon.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
#          tls:
#          - hosts:
#            - hass-appdaemon.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
#            secretName: hass-appdaemon-cert
#          annotations:
#            kubernetes.io/ingress.class: "nginx"
#            cert-manager.io/cluster-issuer: "ca-issuer"

