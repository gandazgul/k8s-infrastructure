# Seedbox ===========================================================
# Transmission and flexget running over an OpenVPN connection ;)

# NOTE: cli args take precedence over these
helmDefaults:
  wait: true
  timeout: 600
  force: true

releases:
  - name: seedbox
    namespace: default
    chart: ../charts/seedbox
    values:
      - vpn:
          env:
          - name: TZ
            value: "EST5EDT"
          - name: TRANSPASS
            value: {{ requiredEnv "TRANSMISSION_RPC_PASSWORD" }}
      - transmission:
          ingress:
            enabled: true
            hosts:
              - host: transmission.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
                servicePort: trans-http
            tls:
              - hosts:
                  - transmission.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
                secretName: transmission-k8s-cert
            annotations:
              kubernetes.io/ingress.class: "nginx"
              cert-manager.io/cluster-issuer: "ca-issuer"
              nginx.ingress.kubernetes.io/app-root: "/web/"
      - flexget:
          env:
            - name: MAIL_TO
              value: {{ requiredEnv "MAIL_TO" }}
            - name: FG_WEBUI_PASSWD
              value: {{ requiredEnv "ADMIN_PASSWORD" }}
          volumeMounts:
            - name: yasr-volume
              mountPath: "/config"
              subPath: "configs/flexget"
            - name: main-volume
              mountPath: "/main"
            - name: yasr-volume
              mountPath: "/data"
              subPath: "configs/transmission"
            - name: tz-config
              mountPath: /etc/localtime
              readOnly: true
          ingress:
            enabled: true
            hosts:
              - host: flexget.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
                servicePort: flexget-http
            tls:
              - hosts:
                  - flexget.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
                secretName: flexget-k8s-cert
            annotations:
              kubernetes.io/ingress.class: "nginx"
              cert-manager.io/cluster-issuer: "ca-issuer"
      - jackett:
          ingress:
            enabled: true
            hosts:
            - host: jackett.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
              servicePort: jackett-http
            tls:
            - hosts:
              - jackett.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
              secretName: jackett-k8s-cert
            annotations:
              kubernetes.io/ingress.class: "nginx"
              cert-manager.io/cluster-issuer: "ca-issuer"
      - sonarr:
          ingress:
            enabled: true
            hosts:
            - host: sonarr.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
              servicePort: sonarr-http
            tls:
            - hosts:
              - sonarr.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
              secretName: sonarr-k8s-cert
            annotations:
              kubernetes.io/ingress.class: "nginx"
              cert-manager.io/cluster-issuer: "ca-issuer"
      - radarr:
          ingress:
            enabled: true
            hosts:
            - host: radarr.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
              servicePort: radarr-http
            tls:
            - hosts:
              - radarr.{{ requiredEnv "INGRESS_INTERNAL_NAME" }}
              secretName: radarr-k8s-cert
            annotations:
              kubernetes.io/ingress.class: "nginx"
              cert-manager.io/cluster-issuer: "ca-issuer"
      - values/seedbox.yaml
