---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minecraft
  namespace: default
spec:
  interval: 5m
  chart:
#    spec:
#      chart: minecraft
#      version: 3.4.2
#      sourceRef:
#        kind: HelmRepository
#        name: minecraft-server-charts
#        namespace: flux-system
#      interval: 5m
    spec:
      chart: ./charts/minecraft
      version: 3.4.2
      sourceRef:
        kind: GitRepository
        name: minecraft-server-charts-fork
        namespace: flux-system
  dependsOn:
  - name: yasr-volume
  # All values at https://github.com/itzg/minecraft-server-charts/blob/master/charts/minecraft/values.yaml
  values:
    securityContext:
      # Security context settings
      runAsUser: 1000
      fsGroup: 1000
    minecraftServer:
      eula: "TRUE"
      serviceType: NodePort
      nodePort: 25565
      # This can be one of "VANILLA", "FORGE", "SPIGOT", "BUKKIT", "PAPER", "FTBA", "SPONGEVANILLA", "CURSEFORGE"
      type: "VANILLA"
      # One of: peaceful, easy, normal, and hard
      difficulty: easy
      # A comma-separated list of player names to whitelist.
      whitelist: cybercrazy
      # A comma-separated list of player names who should be admins.
      ops: cybercrazy
      # The maximum height in which building is allowed.
      maxBuildHeight: 256
      # Max view distance (in chunks).
      viewDistance: 10
      # Define this if you want a specific map generation seed.
      levelSeed: "Q&*fuZE2fZ!f3*ZmqScqVwfSAvHtciGUhg3sK7&t!#yX^o$L@aSc^iVTDt@mggHTiq3*iarbNTGsd9*nX3bCT$G2R9%d6*4Zoj69TGNq*@qTwLDvr2Aw8^JpqM6YYbeq"
      # One of: creative, survival, adventure, spectator
      gameMode: creative
      # Message of the Day
      motd: "Welcome to Minecraft on Kubernetes!"
      # One of: DEFAULT, FLAT, LARGEBIOMES, AMPLIFIED, CUSTOMIZED
      levelType: DEFAULT
      # When levelType == FLAT or CUSTOMIZED, this can be used to further customize map generation.
      # ref: https://hub.docker.com/r/itzg/minecraft-server/
      generatorSettings:
      # Check accounts against Minecraft account service.
      onlineMode: true

    extraEnv:
      TZ: "America/New_York"
    persistence:
      dataDir:
        enabled: true
        existingClaim: yasr-volume
        subPath: configs/minecraft
    resources:
      limits:
        memory: 4900Mi
      requests:
        cpu: 35m
        memory: 1500Mi
